---
title: "Prediction Coronvirus"
author: "Jens Laufer"
date: "2020/02/01"
output:
  md_document: default
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, message = F, warning = F)
```

```{r}
library(tidyverse)
library(bbplot)
library(scales)
library(forecast)
library(tsbox)
library(lubridate)
require(maps)
require(viridis)
source("dataGather.R")
```





```{r}
data <- get.data.jhu()
```




```{r fig.height=10, fig.width=20}
data %>% group_by(date) %>% 
  summarise(total=sum(confirmed)) %>% 
  ungroup() %>% 
  ggplot(aes(x=date, y=total)) +
  #geom_line()+
  geom_smooth() +
  bbc_style()
```


```{r fig.height=10, fig.width=20}
ts_c(data %>% group_by(date) %>% 
  summarise(total=sum(confirmed)) %>% 
  ungroup() %>% select(total)) %>% 
auto.arima() %>%
  forecast(h = 180) %>% 
  autoplot() +
  scale_y_continuous(labels = comma) +
  bbc_style()
```

```{r fig.height=20, fig.width=20}
data %>% 
  group_by(`Country/Region`, date) %>%
  summarise(total=sum(confirmed)) %>% 
  ungroup() %>% 
  ggplot(aes(x=date, y=total)) +
  geom_line()+
  geom_point(size=2)+
  facet_wrap(~`Country/Region`, scales = "free_y")+
  bbc_style()
  
```
```{r fig.height=20, fig.width=20}

data %>% 
  filter(`Country/Region` == "Mainland China") %>% 
  group_by(`Province/State`, date) %>%
  summarise(total=sum(confirmed)) %>% 
  ungroup() %>% 
  ggplot(aes(x=date, y=total)) +
  geom_line()+
  geom_point(size=2)+
  facet_wrap(~`Province/State`, scales = "free_y")+
  bbc_style()
  
```




```{r fig.height=20, fig.width=20}
data %>% 
  filter(`Country/Region` == "Mainland China") %>% 
  ggplot(aes(x=date, y=confirmed_chg_pct))+
  geom_bar(stat="identity") +
  geom_smooth()+
  facet_wrap(~`Province/State`) +
  bbc_style()
  
```

```{r}
mainland.china <- data %>%
  group_by(`Country/Region`, date) %>%
  summarise(
    confirmed = sum(confirmed),
    death = sum(death),
    recovered = sum(recovered)
  ) %>%
  mutate(
    confirmed_chg_pct = confirmed / dplyr::lag(confirmed),
    death_chg_pct = death / dplyr::lag(death),
    recovered_chg_pct = recovered / dplyr::lag(recovered),
    death_rate=death/confirmed,
    recovery_rate=death/recovered,
  ) %>%
  ungroup() %>% 
  filter(`Country/Region` == "Mainland China")
```




```{r}
mainland.china %>% 
  ggplot(aes(x=date, confirmed_chg_pct)) +
  geom_bar(stat="identity") +
  geom_smooth() +
  bbc_style()
```




